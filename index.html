<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R2H — Community Pulse Check</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

<!-- Tally official embed script — the only method that bypasses X-Frame-Options -->

<script src="https://tally.so/widgets/embed.js" async></script>

<style>
  :root {
    --navy:   #1A3A52;
    --teal:   #1A7A8A;
    --amber:  #D4860A;
    --grey:   #717D7E;
    --white:  #FFFFFF;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--navy);
    color: var(--white);
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
    opacity: 0.6;
  }

  .container {
    max-width: 680px;
    margin: 0 auto;
    padding: 60px 24px 80px;
    position: relative;
    z-index: 1;
  }

  .header { margin-bottom: 56px; }

  .badge {
    display: inline-block;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.15em;
    color: var(--teal);
    border: 1px solid var(--teal);
    padding: 5px 12px;
    margin-bottom: 24px;
    text-transform: uppercase;
  }

  .main-title {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(36px, 8vw, 58px);
    line-height: 1.05;
    color: var(--white);
    margin-bottom: 12px;
  }

  .main-title em { font-style: italic; color: var(--amber); }

  .subtitle {
    font-size: 16px;
    color: rgba(255,255,255,0.55);
    line-height: 1.6;
    max-width: 520px;
    font-weight: 300;
  }

  .progress-wrap { margin-bottom: 52px; }

  .progress-text {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--grey);
    margin-bottom: 8px;
    letter-spacing: 0.05em;
    display: flex;
    justify-content: space-between;
  }

  .progress-bar { height: 2px; background: rgba(255,255,255,0.1); }

  .progress-fill {
    height: 100%;
    background: var(--teal);
    transition: width 0.4s ease;
    width: 0%;
  }

  .question-block {
    margin-bottom: 52px;
    opacity: 0;
    transform: translateY(20px);
    animation: fadeUp 0.5s ease forwards;
  }

  .question-block:nth-child(1) { animation-delay: 0.05s; }
  .question-block:nth-child(2) { animation-delay: 0.12s; }
  .question-block:nth-child(3) { animation-delay: 0.19s; }
  .question-block:nth-child(4) { animation-delay: 0.26s; }
  .question-block:nth-child(5) { animation-delay: 0.33s; }
  .question-block:nth-child(6) { animation-delay: 0.40s; }
  .question-block:nth-child(7) { animation-delay: 0.47s; }

  @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }

  .sub-block {
    margin-top: 24px;
    padding: 20px;
    border-left: 2px solid rgba(26,122,138,0.4);
    background: rgba(26,122,138,0.05);
  }

  .q-number {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--teal);
    letter-spacing: 0.12em;
    margin-bottom: 8px;
    text-transform: uppercase;
  }

  .q-number.sub { color: rgba(26,122,138,0.7); }

  .q-text {
    font-family: 'DM Serif Display', serif;
    font-size: 20px;
    line-height: 1.4;
    color: var(--white);
    margin-bottom: 6px;
  }

  .q-text.sub { font-size: 17px; }

  .q-sub {
    font-size: 13px;
    color: rgba(255,255,255,0.4);
    margin-bottom: 18px;
    line-height: 1.5;
    font-weight: 300;
  }

  .options { display: flex; flex-direction: column; gap: 8px; }

  .option-btn {
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.1);
    color: rgba(255,255,255,0.75);
    padding: 14px 44px 14px 18px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    cursor: pointer;
    text-align: left;
    transition: all 0.2s ease;
    line-height: 1.4;
    position: relative;
  }

  .option-btn:hover { border-color: var(--teal); color: var(--white); background: rgba(26,122,138,0.12); }

  .option-btn.selected {
    border-color: var(--teal);
    background: rgba(26,122,138,0.2);
    color: var(--white);
  }

  .option-btn.selected::after {
    content: '✓';
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--teal);
    font-size: 13px;
    font-weight: 700;
  }

  .multi-option {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.1);
    padding: 14px 16px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .multi-option:hover { border-color: var(--teal); background: rgba(26,122,138,0.1); }
  .multi-option.selected { border-color: var(--teal); background: rgba(26,122,138,0.18); }

  .role-flag {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 0.1em;
    color: var(--amber);
    border: 1px solid rgba(212,134,10,0.4);
    padding: 2px 6px;
    margin-left: 8px;
    white-space: nowrap;
    text-transform: uppercase;
    display: inline-block;
    position: relative;
    top: -1px;
  }

  .checkbox-box {
    width: 16px;
    height: 16px;
    border: 1px solid rgba(255,255,255,0.25);
    flex-shrink: 0;
    margin-top: 2px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }

  .multi-option.selected .checkbox-box { background: var(--teal); border-color: var(--teal); }
  .checkbox-tick { color: white; font-size: 10px; display: none; }
  .multi-option.selected .checkbox-tick { display: block; }
  .multi-label { font-size: 14px; color: rgba(255,255,255,0.7); line-height: 1.4; flex: 1; }
  .multi-option.selected .multi-label { color: var(--white); }

  .scale-wrap { display: flex; gap: 6px; align-items: center; }

  .scale-btn {
    width: 44px;
    height: 44px;
    border: 1px solid rgba(255,255,255,0.1);
    background: rgba(255,255,255,0.04);
    color: rgba(255,255,255,0.6);
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .scale-btn:hover { border-color: var(--teal); color: var(--white); background: rgba(26,122,138,0.15); }
  .scale-btn.selected { background: var(--teal); border-color: var(--teal); color: var(--white); }

  .scale-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 8px;
    font-size: 11px;
    color: rgba(255,255,255,0.3);
    font-family: 'Space Mono', monospace;
  }

  .open-input {
    width: 100%;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--white);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    padding: 14px 16px;
    resize: vertical;
    min-height: 80px;
    line-height: 1.6;
    transition: border-color 0.2s;
    outline: none;
  }

  .open-input::placeholder { color: rgba(255,255,255,0.25); }
  .open-input:focus { border-color: var(--teal); }

  .section-divider {
    display: flex;
    align-items: center;
    gap: 16px;
    margin: 40px 0 32px;
  }

  .section-divider span {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.12em;
    color: var(--amber);
    text-transform: uppercase;
    white-space: nowrap;
  }

  .section-divider::before,
  .section-divider::after { content: ''; flex: 1; height: 1px; background: rgba(255,255,255,0.08); }

  .submit-section {
    margin-top: 56px;
    padding-top: 40px;
    border-top: 1px solid rgba(255,255,255,0.08);
  }

  .submit-note {
    font-size: 13px;
    color: rgba(255,255,255,0.35);
    margin-bottom: 20px;
    line-height: 1.6;
    font-weight: 300;
  }

  .submit-btn {
    background: var(--teal);
    color: var(--white);
    border: none;
    padding: 18px 40px;
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    letter-spacing: 0.02em;
    transition: all 0.2s;
    display: inline-block;
  }

  .submit-btn:hover { background: #15606d; transform: translateY(-1px); }
  .submit-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  .thankyou { display: none; text-align: center; padding: 80px 0; }
  .thankyou.show { display: block; }
  .thankyou-icon { font-size: 48px; margin-bottom: 24px; }

  .thankyou h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 36px;
    color: var(--white);
    margin-bottom: 16px;
  }

  .thankyou p {
    color: rgba(255,255,255,0.55);
    font-size: 15px;
    line-height: 1.7;
    max-width: 420px;
    margin: 0 auto;
    font-weight: 300;
  }

  .footer {
    margin-top: 80px;
    padding-top: 24px;
    border-top: 1px solid rgba(255,255,255,0.06);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 12px;
  }

  .footer-brand {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: rgba(255,255,255,0.25);
    letter-spacing: 0.08em;
  }

  .footer-note { font-size: 11px; color: rgba(255,255,255,0.2); text-align: right; }
</style>

</head>
<body>

<div class="container">

  <div class="header">
    <div class="badge">R2H · Community Pulse Check · 2026</div>
    <h1 class="main-title">Does this<br><em>exist</em> for you?</h1>
    <p class="subtitle">We're building something that wasn't there when we came home. Before we build it, we want to know if it's what the community actually needs. This is not a survey. It's a conversation starter. Blunt answers only.</p>
  </div>

  <div id="poll-form">

```
<div class="progress-wrap">
  <div class="progress-text">
    <span>QUESTION PROGRESS</span>
    <span id="progressLabel">0 of 7</span>
  </div>
  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
</div>

<!-- Q1 -->
<div class="question-block">
  <div class="q-number">01 · The Moment It Hit</div>
  <div class="q-text">When you left rehab — or watched someone leave — what was the first thing that hit you?</div>
  <div class="q-sub">The fear that landed hardest. Pick the one that's truest.</div>
  <div class="options" data-q="q1" data-type="single">
    <button class="option-btn" data-val="fear_capability">Not knowing if I could actually handle what was coming.</button>
    <button class="option-btn" data-val="fear_system">Not knowing who to call when something went wrong.</button>
    <button class="option-btn" data-val="fear_family">Being terrified of what this was going to do to the people around me.</button>
    <button class="option-btn" data-val="fear_identity">Not recognising the life I was going home to.</button>
    <button class="option-btn" data-val="fear_numb">Nothing. I was too numb to feel anything yet.</button>
  </div>
</div>

<!-- Q2 -->
<div class="question-block">
  <div class="q-number">02 · The Discharge Experience</div>
  <div class="q-text">How prepared did discharge actually feel?</div>
  <div class="q-sub">1 = completely blindsided · 5 = genuinely ready</div>
  <div class="scale-wrap" data-q="q2" data-type="scale">
    <button class="scale-btn" data-val="1">1</button>
    <button class="scale-btn" data-val="2">2</button>
    <button class="scale-btn" data-val="3">3</button>
    <button class="scale-btn" data-val="4">4</button>
    <button class="scale-btn" data-val="5">5</button>
  </div>
  <div class="scale-labels"><span>blindsided</span><span>genuinely ready</span></div>

  <div class="sub-block">
    <div class="q-number sub">02b · What Fell Through</div>
    <div class="q-text sub">What specifically wasn't there when you needed it?</div>
    <div class="q-sub" style="margin-bottom:14px;">Select all that apply.</div>
    <div class="options" data-q="q2b" data-type="multi" style="margin-bottom:14px;">
      <div class="multi-option" data-val="ndis"><div class="checkbox-box"><span class="checkbox-tick">✓</span></div><div class="multi-label">NDIS / funding — equipment, modifications, supports not in place at discharge</div></div>
      <div class="multi-option" data-val="clinical"><div class="checkbox-box"><span class="checkbox-tick">✓</span></div><div class="multi-label">Clinical continuity — bowel, bladder, skin routines with no backup when things went wrong</div></div>
      <div class="multi-option" data-val="emergency"><div class="checkbox-box"><span class="checkbox-tick">✓</span></div><div class="multi-label">An emergency contact — a real person who knew my situation and could actually help</div></div>
      <div class="multi-option" data-val="family_prep"><div class="checkbox-box"><span class="checkbox-tick">✓</span></div><div class="multi-label">Family preparation — carers thrown in at the deep end with no real training or support</div></div>
      <div class="multi-option" data-val="mental_health"><div class="checkbox-box"><span class="checkbox-tick">✓</span></div><div class="multi-label">Mental health support — the emotional crash of leaving the ward structure</div></div>
      <div class="multi-option" data-val="information"><div class="checkbox-box"><span class="checkbox-tick">✓</span></div><div class="multi-label">A single source of truth — piecing information together from five different places</div></div>
      <div class="multi-option" data-val="peer"><div class="checkbox-box"><span class="checkbox-tick">✓</span></div><div class="multi-label">Peer connection — someone who'd actually been through it and could tell me what was real</div></div>
    </div>
    <textarea class="open-input" data-q="q2b_other" data-type="text" placeholder="Anything else that fell through — in your own words..." style="min-height:60px;"></textarea>
  </div>
</div>

<!-- Q3 -->
<div class="question-block">
  <div class="q-number">03 · How Long</div>
  <div class="q-text">How long before things felt even remotely stable at home?</div>
  <div class="q-sub">"Stable" meaning routines holding, supports in place, not in crisis mode.</div>
  <div class="options" data-q="q3" data-type="single">
    <button class="option-btn" data-val="never">It never really did — or hasn't yet.</button>
    <button class="option-btn" data-val="months_6plus">More than six months.</button>
    <button class="option-btn" data-val="months_3to6">Three to six months.</button>
    <button class="option-btn" data-val="months_1to3">One to three months.</button>
    <button class="option-btn" data-val="weeks_2to4">Two to four weeks.</button>
    <button class="option-btn" data-val="week_1">Within the first week.</button>
  </div>
</div>

<div class="section-divider"><span>About R2H</span></div>

<!-- Q4 -->
<div class="question-block">
  <div class="q-number">04 · The Concept</div>
  <div class="q-text">The moment you leave rehab, the system essentially stops. R2H is a free tool — no download, any device — that stays with you through discharge, the first week, and community reintegration. It's built to be deleted when you don't need it anymore. Deletion is the goal.</div>
  <div class="q-sub">If this had existed — would it have changed anything for you?</div>
  <div class="options" data-q="q4" data-type="single">
    <button class="option-btn" data-val="yes_critical">Yes — this is exactly what was missing. It would have changed a lot.</button>
    <button class="option-btn" data-val="yes_helpful">Yes — it would have helped, even if it didn't fix everything.</button>
    <button class="option-btn" data-val="maybe">Maybe — depends entirely on how it's done and who's behind it.</button>
    <button class="option-btn" data-val="no_different">No — my situation needed something different.</button>
    <button class="option-btn" data-val="no_tool">No tool could have helped with what we were dealing with.</button>
  </div>
</div>

<!-- Q5 -->
<div class="question-block">
  <div class="q-number">05 · The Tone</div>
  <div class="q-text">R2H is built on radical honesty. No toxic positivity. No "you've got this." No inspirational framing when things genuinely suck. How much does that matter to you?</div>
  <div class="q-sub">1 = doesn't matter · 5 = that's the whole point</div>
  <div class="scale-wrap" data-q="q5" data-type="scale">
    <button class="scale-btn" data-val="1">1</button>
    <button class="scale-btn" data-val="2">2</button>
    <button class="scale-btn" data-val="3">3</button>
    <button class="scale-btn" data-val="4">4</button>
    <button class="scale-btn" data-val="5">5</button>
  </div>
  <div class="scale-labels"><span>doesn't matter</span><span>the whole point</span></div>
</div>

<!-- Q6 -->
<div class="question-block">
  <div class="q-number">06 · Your Role in This</div>
  <div class="q-text">R2H is being built with the community, not for it. What level of involvement makes sense for you?</div>
  <div class="q-sub">Select all that apply. Roles marked <strong style="color:var(--amber);font-weight:600;">ACTIVE ROLE</strong> require real commitment — we're not collecting names, we're building a team.</div>
  <div class="options" data-q="q6" data-type="multi">
    <div class="multi-option" data-val="workingparty">
      <div class="checkbox-box"><span class="checkbox-tick">✓</span></div>
      <div class="multi-label">Working party — formal lived experience authority role with Austin Health <span class="role-flag">Active Role</span></div>
    </div>
    <div class="multi-option" data-val="codesign">
      <div class="checkbox-box"><span class="checkbox-tick">✓</span></div>
      <div class="multi-label">Co-design — direct input on what R2H does and how it works <span class="role-flag">Active Role</span></div>
    </div>
    <div class="multi-option" data-val="pilot">
      <div class="checkbox-box"><span class="checkbox-tick">✓</span></div>
      <div class="multi-label">Pilot participant — use R2H during or after discharge and give real feedback <span class="role-flag">Active Role</span></div>
    </div>
    <div class="multi-option" data-val="test">
      <div class="checkbox-box"><span class="checkbox-tick">✓</span></div>
      <div class="multi-label">Testing — try early versions and give blunt, honest feedback</div>
    </div>
    <div class="multi-option" data-val="spread">
      <div class="checkbox-box"><span class="checkbox-tick">✓</span></div>
      <div class="multi-label">Spreading the word — share this with others in the SCI community</div>
    </div>
    <div class="multi-option" data-val="watch">
      <div class="checkbox-box"><span class="checkbox-tick">✓</span></div>
      <div class="multi-label">Keep me informed — I want to watch how this develops</div>
    </div>
  </div>
</div>

<!-- Q7 -->
<div class="question-block">
  <div class="q-number">07 · The Most Important One</div>
  <div class="q-text">What do you wish had existed to help you ride the transition home better?</div>
  <div class="q-sub">Be specific if you can. A tool, a person, a system, a piece of information. What was the thing that wasn't there?</div>
  <textarea class="open-input" data-q="q7" data-type="text" placeholder="What would have actually made a difference..."></textarea>
</div>

<!-- SUBMIT -->
<div class="submit-section">
  <p class="submit-note">Anonymous unless you choose to share your contact below. No data sold. No spam. If you selected an Active Role above, leaving your contact is how we reach you.</p>
  <textarea class="open-input" data-q="contact" data-type="text" placeholder="Optional: name / email / how to reach you — required if you want an active role" style="min-height:56px; margin-bottom:20px;"></textarea>
  <button class="submit-btn" id="submitBtn">Submit — I've said my piece</button>
</div>
```

  </div>

  <div class="thankyou" id="thankyou">
    <div class="thankyou-icon">✊</div>
    <h2>That's a 1mm forward.</h2>
    <p>Your response goes directly into the design of R2H — not into a spreadsheet nobody reads. The SCI community is building this. You're part of it.</p>
  </div>

  <div class="footer">
    <div class="footer-brand">R2H · REHAB TO HOME · MELBOURNE 2026</div>
    <div class="footer-note">A lived experience initiative<br>in partnership with Austin Health</div>
  </div>

</div>

<script>
  // ─── STATE ───────────────────────────────────────────────
  const answers = {};
  const TRACKED = ['q1','q2','q2b','q3','q4','q5','q6'];
  const TALLY_FORM_ID = '4486VX';

  // ─── PROGRESS ────────────────────────────────────────────
  function updateProgress() {
    let answered = 0;
    TRACKED.forEach(q => {
      const v = answers[q];
      if (v !== undefined && v !== '' && !(Array.isArray(v) && v.length === 0)) answered++;
    });
    const pct = Math.round((answered / TRACKED.length) * 100);
    document.getElementById('progressFill').style.width = pct + '%';
    document.getElementById('progressLabel').textContent = answered + ' of 7';
  }

  // ─── SINGLE SELECT ───────────────────────────────────────
  document.querySelectorAll('.options[data-type="single"]').forEach(group => {
    const q = group.dataset.q;
    group.querySelectorAll('.option-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        group.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        answers[q] = btn.dataset.val;
        updateProgress();
      });
    });
  });

  // ─── MULTI SELECT ────────────────────────────────────────
  document.querySelectorAll('.options[data-type="multi"]').forEach(group => {
    const q = group.dataset.q;
    answers[q] = [];
    group.querySelectorAll('.multi-option').forEach(opt => {
      opt.addEventListener('click', () => {
        opt.classList.toggle('selected');
        const val = opt.dataset.val;
        if (opt.classList.contains('selected')) {
          if (!answers[q].includes(val)) answers[q].push(val);
        } else {
          answers[q] = answers[q].filter(v => v !== val);
        }
        updateProgress();
      });
    });
  });

  // ─── SCALE ───────────────────────────────────────────────
  document.querySelectorAll('.scale-wrap[data-type="scale"]').forEach(wrap => {
    const q = wrap.dataset.q;
    wrap.querySelectorAll('.scale-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        wrap.querySelectorAll('.scale-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        answers[q] = btn.dataset.val;
        updateProgress();
      });
    });
  });

  // ─── TEXT INPUTS ─────────────────────────────────────────
  document.querySelectorAll('.open-input[data-type="text"]').forEach(input => {
    input.addEventListener('input', () => { answers[input.dataset.q] = input.value.trim(); });
  });

  // ─── SUBMIT ──────────────────────────────────────────────
  /*
   * HOW THIS WORKS:
   * We collect all answers in our custom UI, then on submit we use
   * Tally's official popup API (loaded via embed.js in <head>) to
   * open the real Tally form as an overlay — passing all answers as
   * hidden field URL params so Tally pre-fills and auto-submits them.
   *
   * Tally's embed.js is the ONLY method that bypasses X-Frame-Options.
   * It handles its own submission, fires a 'Tally.FormSubmitted' window
   * event on success, and we catch that to show our custom thank you.
   *
   * IN YOUR TALLY FORM: add hidden fields named exactly:
   * q1, q2, q2b, q3, q4, q5, q6, q2b_other, q7, contact
   */
  document.getElementById('submitBtn').addEventListener('click', () => {
    const btn = document.getElementById('submitBtn');
    btn.disabled = true;
    btn.textContent = 'Sending...';

    // Build hidden field params from all answers
    const hiddenFields = {};
    Object.entries(answers).forEach(([key, val]) => {
      const v = Array.isArray(val) ? val.join(', ') : val;
      if (v) hiddenFields[key] = v;
    });

    // Listen for Tally's submission confirmation before opening popup
    window.addEventListener('message', function onTallyMessage(e) {
      try {
        const data = typeof e.data === 'string' ? JSON.parse(e.data) : e.data;
        const isSubmitted =
          (data && typeof data === 'string' && data.includes('Tally.FormSubmitted')) ||
          (data && data.event === 'Tally.FormSubmitted') ||
          (data && data.type === 'tally-form-submitted');

        if (isSubmitted) {
          window.removeEventListener('message', onTallyMessage);
          // Close Tally popup if still open
          if (window.Tally) window.Tally.closePopup(TALLY_FORM_ID);
          showThankYou();
        }
      } catch (_) {}
    });

    // Open Tally popup with hidden fields pre-filled
    // If Tally embed.js hasn't loaded yet, fall back to direct redirect
    if (window.Tally) {
      window.Tally.openPopup(TALLY_FORM_ID, {
        layout: 'modal',
        width: 700,
        hiddenFields: hiddenFields,
        autoClose: 2000, // auto-close popup 2s after submission
        onSubmit: () => {
          showThankYou();
        },
        onClose: () => {
          // If they close without submitting, re-enable the button
          if (document.getElementById('poll-form').style.display !== 'none') {
            btn.disabled = false;
            btn.textContent = 'Submit — I\'ve said my piece';
          }
        }
      });
    } else {
      // Fallback: direct redirect to Tally with params in URL
      // Tally will show its own thank you page in this case
      const params = new URLSearchParams(hiddenFields);
      window.location.href = `https://tally.so/r/${TALLY_FORM_ID}?${params.toString()}`;
    }
  });

  function showThankYou() {
    document.getElementById('poll-form').style.display = 'none';
    document.getElementById('thankyou').classList.add('show');
    document.getElementById('progressFill').style.width = '100%';
    document.getElementById('progressLabel').textContent = '7 of 7';
  }
</script>

</body>
Open iCloudou page in this case
      const params = new URLSearchParams(hiddenFields);
      window.location.href = `https://tally.so/r/${TALLY_FORM_ID}?${params.toString()}`;
    }
  });

  function showThankYou() {
    document.getElementById('poll-form').style.display = 'none';
    document.getElementById('thankyou').classList.add('show');
    document.getElementById('progressFill').style.width = '100%';
    document.getElementById('progressLabel').textContent = '7 of 7';
  }
</script>

</body>
this case
      const params = new URLSearchParams(hiddenFields);
      window.location.href = `https://tally.so/r/${TALLY_FORM_ID}?${params.toString()}`;
    }
  });

  function showThankYou() {
    document.getElementById('poll-form').style.display = 'none';
    document.getElementById('thankyou').classList.add('show');
    document.getElementById('progressFill').style.width = '100%';
    document.getElementById('progressLabel').textContent = '7 of 7';
  }
</script>

</body>
</html>